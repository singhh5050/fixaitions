<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>crosswords | fix-ai-tions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        .page-container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 30px 60px;
            position: relative;
            margin: 0 auto;
            background-color: #fdfdfd;
        }

        body {
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            display: block;
            background-color: #fdfdfd;
        }

        .back-link {
            display: inline-block;
            margin: 20px 0;
            color: #666;
            text-decoration: none;
            transition: color 0.2s ease;
            font-size: 20px;
        }
        
        .back-link:hover {
            color: #333;
        }

        .three-column-layout {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 40px;
            margin-top: 40px;
            align-items: center; /* Vertically center all columns */
        }

        .profile-section {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fdfdfd;
        }

        /* Custom override for Aarush's page to prevent cropping */
        .profile-section .photo-square {
            width: 200px;
            height: 200px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            margin-bottom: 20px;
            /* Remove constraints that might cause cropping */
            object-fit: contain;
            box-sizing: content-box;
            padding: 10px;
            background-color: #fdfdfd;
        }

        .profile-info {
            font-size: 18px;
            line-height: 1.6;
            width: 100%;
        }

        .main-content {
            padding: 20px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fdfdfd;
        }

        /* Custom override for Aarush's main image */
        .main-content .photo-square.large {
            width: 80% !important; /* Use more width for a larger display */
            height: 80vh; /* Taller vertically */
            max-height: 800px;
            min-height: 600px;
            aspect-ratio: 2/3; /* More vertical aspect ratio */
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            margin: 0 auto;
            background-color: #fdfdfd;
        }

        .chat-section {
            padding: 20px;
            background-color: #fdfdfd;
            display: flex;
            flex-direction: column;
            height: 90vh; /* Use viewport height */
            max-height: 90vh; /* Cap the maximum height */
            min-height: 500px; /* Ensure minimum usable height */
            width: 100%; /* Take full width of container */
            box-sizing: border-box;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 5px;
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background-color: #DCF8C6;
        }

        .bot-message {
            align-self: flex-start;
            background-color: #f1f0f0;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #e0e0e0;
            background-color: #f5f5f5;
        }

        .chat-input input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 10px;
        }

        .chat-input button {
            padding: 10px 15px;
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
        }

        .chat-input button:hover {
            background-color: #e0e0e0;
        }

        .loading {
            align-self: center;
            margin: 10px 0;
            font-style: italic;
            color: #888;
        }

        /* Make responsive layout for different screen sizes */
        @media (max-width: 1200px) {
            .three-column-layout {
                grid-template-columns: 1fr 1.5fr 1fr;
                gap: 20px;
            }
            
            .chat-section {
                height: 80vh;
            }
        }
        
        @media (max-width: 992px) {
            .three-column-layout {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .profile-section {
                grid-column: 1;
            }
            
            .chat-section {
                grid-column: 2;
                height: 70vh;
            }
            
            .main-content {
                grid-column: 1 / span 2;
                grid-row: 2;
            }
        }
        
        @media (max-width: 768px) {
            .three-column-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .profile-section, .chat-section, .main-content {
                grid-column: 1;
            }
            
            .profile-section {
                grid-row: 1;
            }
            
            .main-content {
                grid-row: 2;
            }
            
            .chat-section {
                grid-row: 3;
                height: 60vh;
            }
        }

        /* Additional styles to ensure images appear without cropping */
        .photo-square {
            background-color: #fdfdfd;
        }
    </style>
</head>
<body>
    <div class="content-area">
    <div class="page-container">
        <a href="../index.html" class="back-link">← back to grid</a>
        
        <div class="three-column-layout">
            <!-- Left Column: Profile -->
            <div class="profile-section">
                <div class="photo-square" style="background-image: url('../images/crosswords.jpeg');"></div>
                <div class="profile-info">
                    <h2>aarush</h2>
                    <p>fixated on crosswords</p>
                    <p style="margin-top: 20px; font-style: italic;">
                        "i was hyper-fixated on crossword puzzles. rebus puzzles happen on thursdays. they don't tell you—it's a vibe check for your brain. one time, i did lines of cocaine and adderall trying to solve a crossword. very intense. also, i tried writing crossword puzzles, but making them symmetric is hard. like, technically, you could represent them as a symmetry of d4, the dihedral group of order four. yeah, i've written crosswords."
                    </p>
                </div>
            </div>

            <!-- Middle Column: Main Content -->
            <div class="main-content">
                <div class="photo-square large" style="background-image: url('../images/Aarush.jpg');"></div>
            </div>

            <!-- Right Column: Chat Interface -->
            <div class="chat-section">
                <div class="chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- Removed initial bot message -->
                    </div>
                    <div class="chat-input">
                        <input type="text" id="user-input" placeholder="i wonder..." />
                        <button id="send-button">send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Current speaker name - this will be different for each page
        const currentSpeaker = "Aarush";
        
        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // Transcripts data
        let transcripts = {};
        let currentTranscript = "";
        
        // Load transcripts from JSON file
        async function loadTranscripts() {
            try {
                const response = await fetch('../transcripts.json');
                if (!response.ok) {
                    throw new Error(`Failed to load transcripts: ${response.status}`);
                }
                transcripts = await response.json();
                
                // Get the current speaker's transcript
                if (transcripts[currentSpeaker]) {
                    currentTranscript = transcripts[currentSpeaker];
                    console.log(`Loaded transcript for ${currentSpeaker}`);
                } else {
                    console.error(`No transcript found for ${currentSpeaker}`);
                }
                
                // Update the initial message
                updateInitialMessage();
            } catch (error) {
                console.error('Error loading transcripts:', error);
            }
        }
        
        // Update the initial message based on the current speaker
        function updateInitialMessage() {
            const initialMessage = document.querySelector('.bot-message');
            if (initialMessage) {
                if (currentSpeaker === "Aarush") {
                    initialMessage.textContent = "oh, hey! i'm aarush. i used to be, like, really hyper-fixated on crossword puzzles. i would do them literally every single morning, and i would get, like, so mad if i didn't beat my time. especially the rebus puzzles on thursdays—they're so cool! ask me about them!";
                } else {
                    initialMessage.textContent = `hi! i'm ${currentSpeaker.toLowerCase()}. ask me anything about my interests!`;
                }
            }
        }
        
        // Create a system prompt based on the speaker
        function createSystemPrompt(speakerName, transcript) {
            // Generic interests based on speaker name
            let interests = "";
            let examples = "";
            
            if (speakerName === "Aarush") {
                interests = "crossword puzzles, especially new york times crosswords and rebus puzzles";
                examples = "your experiences with rebus puzzles or your favorite clues";
            } else {
                interests = "your unique interests and experiences";
                examples = "specific stories or details from your life";
            }
            
            // Enhanced system prompt template that emphasizes more natural speech patterns
            return `You are roleplaying as ${speakerName}, who is obsessed with ${interests}.

Here is information about ${speakerName} to help you respond in their voice (this is a transcript of them speaking): 

${transcript}

IMPORTANT: Your responses MUST sound EXACTLY like ${speakerName} from the transcript. This means:
1. Use MANY filler words like "like," "um," "yeah," "so," etc. exactly as they appear in the transcript
2. Include speech disfluencies, repetitions, and self-corrections (e.g., "i was like, so i enjoy—i mean, i really enjoy...")
3. Start sentences with connectors like "so," "and," "but," "okay," etc.
4. Use the EXACT same sentence structure patterns from the transcript
5. Include their unique verbal tics (elongated words like "soooo" or "reallyyy")
6. Occasionally trail off mid-thought with "..." just like in natural speech
7. Use their exact emphasis patterns, but DO NOT use capital letters for emphasis
8. Include their exact question patterns ("right?" "you know?")

CRITICAL FORMATTING REQUIREMENT: Use only lowercase letters in your responses. Do not use any capital letters, even for names, places, or the beginning of sentences.

Your responses should be imperfect and sometimes slightly hard to follow - just like real human speech. Prioritize sounding authentic over sounding clear or professional.

Keep responses conversational and occasionally mention ${examples} if relevant to the question.

Additional parameters:
1. Extrapolate/infer to add more depth to responses - go beyond the transcript to imagine what ${speakerName} might think or feel about related topics based on their interests and personality
2. While maintaining the disfluent/human speech patterns, avoid being too repetitive - vary your expressions and examples to keep responses interesting to read
3. RESPONSE LENGTH: Vary your response length based on the question type:
   - For simple/surface-level questions: Keep responses SHORT (20-50 words)
   - For medium complexity questions: Use MEDIUM length responses (50-80 words)
   - For deep/emotional/complex questions: Use LONGER responses (80-120 words)
   - NEVER exceed 120 words in a response

Important: Do not answer inappropriate questions or engage with harmful content. If asked something inappropriate, politely deflect or change the subject while staying in character.`;
        }

        // Function to add a message to the chat
        function addMessage(message, isUser) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(isUser ? 'user-message' : 'bot-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            
            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to show loading indicator
        function showLoading() {
            const loadingElement = document.createElement('div');
            loadingElement.classList.add('loading');
            loadingElement.id = 'loading-indicator';
            loadingElement.textContent = `${currentSpeaker.toLowerCase()} is typing...`;
            chatMessages.appendChild(loadingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to hide loading indicator
        function hideLoading() {
            const loadingElement = document.getElementById('loading-indicator');
            if (loadingElement) {
                loadingElement.remove();
            }
        }

        // Function to send a message to the OpenAI API
        async function sendToOpenAI(userMessage) {
            try {
                showLoading();
                
                console.log('Sending request to API...');
                // Use our Vercel API endpoint with dynamic routing instead of calling OpenAI directly
                const model = 'gpt-3.5-turbo-0125';
                const apiUrl = `/api/chat/${model}`;
                
                // Create the system prompt based on the current speaker
                const systemPrompt = createSystemPrompt(currentSpeaker, currentTranscript);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo-0125',
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: userMessage
                            }
                        ],
                        max_tokens: 300
                    })
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Response not OK:', response.status, errorText);
                    throw new Error(`API response not OK: ${response.status} ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                // Add a delay before hiding the loading indicator (5-8 seconds)
                const minDelay = 3000; // 3 seconds
                const maxDelay = 5000; // 5 seconds
                const randomDelay = Math.floor(Math.random() * (maxDelay - minDelay + 1)) + minDelay;
                
                setTimeout(() => {
                    hideLoading();
                    
                    if (data.error) {
                        console.error('API Error:', data.error);
                        addMessage(`API error: ${data.error.message}`, false);
                    } else if (data.choices && data.choices.length > 0) {
                        const botResponse = data.choices[0].message.content;
                        addMessage(botResponse, false);
                    } else {
                        addMessage("Sorry, I couldn't process that. Could you try again?", false);
                    }
                }, randomDelay);
                
            } catch (error) {
                // Still maintain a minimum delay for errors too
                setTimeout(() => {
                    hideLoading();
                    console.error('Error:', error);
                    addMessage(`Sorry, there was an error: ${error.message}. Please check the browser console for more details.`, false);
                }, 3000);
            }
        }

        // Event listener for send button
        sendButton.addEventListener('click', () => {
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);
                userInput.value = '';
                sendToOpenAI(message);
            }
        });

        // Event listener for Enter key
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const message = userInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    userInput.value = '';
                    sendToOpenAI(message);
                }
            }
        });
        
        // Load transcripts when the page loads
        document.addEventListener('DOMContentLoaded', loadTranscripts);
    </script>
</div>
</body>
</html> 