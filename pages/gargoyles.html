<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>the moor | fix-ai-tions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        .page-container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 30px 60px;
            position: relative;
            width: calc(100% - 40px);
            background-color: #fdfdfd;
        }

        body {
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            display: block;
            background-color: #fdfdfd;
        }

        .back-link {
            display: inline-block;
            margin: 20px 0;
            color: #666;
            text-decoration: none;
            transition: color 0.2s ease;
            font-size: 20px;
        }
        
        .back-link:hover {
            color: #333;
        }

        .three-column-layout {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 40px;
            margin-top: 40px;
        }

        .profile-section {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fdfdfd;
        }

        /* Custom override for profile icon to prevent cropping */
        .profile-section .photo-square {
            width: 200px;
            height: 200px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            margin-bottom: 20px;
            /* Remove constraints that might cause cropping */
            object-fit: contain;
            box-sizing: content-box;
            padding: 10px;
            background-color: #fdfdfd;
        }

        .profile-info {
            font-size: 18px;
            line-height: 1.6;
            width: 100%;
        }

        .main-content {
            padding: 20px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fdfdfd;
        }

        /* Custom override for main image */
        .main-content .photo-square.large {
            width: 60%; /* Narrower horizontally */
            height: 80vh; /* Taller vertically */
            max-height: 800px;
            min-height: 600px;
            aspect-ratio: 2/3; /* More vertical aspect ratio */
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            margin: 0 auto;
            background-color: #fdfdfd;
        }

        .chat-section {
            padding: 20px;
            background-color: #fdfdfd;
            display: flex;
            flex-direction: column;
            height: 80vh;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .chat-header {
            background-color: #f5f5f5;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: bold;
            text-align: center;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 5px;
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background-color: #DCF8C6;
        }

        .bot-message {
            align-self: flex-start;
            background-color: #f1f0f0;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #e0e0e0;
            background-color: #f5f5f5;
        }

        .chat-input input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 10px;
        }

        .chat-input button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .chat-input button:hover {
            background-color: #45a049;
        }

        .loading {
            align-self: center;
            margin: 10px 0;
            font-style: italic;
            color: #888;
        }

        @media (max-width: 1024px) {
            .three-column-layout {
                grid-template-columns: 1fr 1fr;
            }
            .chat-section {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            .three-column-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .chat-section {
                grid-column: auto;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <a href="../index.html" class="back-link">← back to grid</a>
        
        <div class="three-column-layout">
            <!-- Left Column: Profile -->
            <div class="profile-section">
                <div class="photo-square" style="background-image: url('../images/moor.jpg');"></div>
                <div class="profile-info">
                    <h2>georgina</h2>
                    <p>fixated on the moor</p>
                    <p style="margin-top: 20px; font-style: italic;">
                        "i go to the dartmoor prison museum every tuesday, just the prison museum. i love it. the first time i went, i saw the bloodstain on the wall from this executed prisoner. i just felt this intense connection to moorland all of a sudden. i have a map of the moor above my bed. i constantly think about it. there's something so stark and harsh about it—it's like it's cut right through me."
                    </p>
                </div>
            </div>

            <!-- Middle Column: Main Content -->
            <div class="main-content">
                <div class="photo-square large" style="background-image: url('../images/georgina.jpeg');"></div>
            </div>

            <!-- Right Column: Chat Interface -->
            <div class="chat-section">
                <div class="chat-container">
                    <div class="chat-header">
                        chat with georgina about the moor
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="message bot-message">
                            hi there! i'm georgina. i'm absolutely fascinated by dartmoor. ask me anything about my connection to the moor!
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="user-input" placeholder="type your message here..." />
                        <button id="send-button">send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Current speaker name - this will be different for each page
        const currentSpeaker = "Georgina";
        
        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // Transcripts data
        let transcripts = {};
        let currentTranscript = "";
        
        // Load transcripts from JSON file
        async function loadTranscripts() {
            try {
                const response = await fetch('../transcripts.json');
                if (!response.ok) {
                    throw new Error(`Failed to load transcripts: ${response.status}`);
                }
                transcripts = await response.json();
                
                // Get the current speaker's transcript
                if (transcripts[currentSpeaker]) {
                    currentTranscript = transcripts[currentSpeaker];
                    console.log(`Loaded transcript for ${currentSpeaker}`);
                } else {
                    console.error(`No transcript found for ${currentSpeaker}`);
                }
                
                // Update the initial message
                updateInitialMessage();
            } catch (error) {
                console.error('Error loading transcripts:', error);
            }
        }
        
        // Update the initial message based on the current speaker
        function updateInitialMessage() {
            const initialMessage = document.querySelector('.bot-message');
            if (initialMessage) {
                if (currentSpeaker === "Georgina") {
                    initialMessage.textContent = "hello! i'm georgina and i visit the dartmoor prison museum every tuesday. there's something about the moor that's just cut right through me. i have a map of dartmoor above my bed and think about it constantly. what would you like to know?";
                } else {
                    initialMessage.textContent = `hi! i'm ${currentSpeaker}. ask me anything about my interests!`;
                }
            }
        }
        
        // Create a system prompt based on the speaker
        function createSystemPrompt(speakerName, transcript) {
            // Generic interests based on speaker name
            let interests = "";
            let examples = "";
            
            if (speakerName === "Georgina") {
                interests = "the English moors and Jane Austen novels";
                examples = "your fascination with the moors or how you read Jane Austen in a British accent";
            } else {
                interests = "your unique interests and experiences";
                examples = "specific stories or details from your life";
            }
            
            // Enhanced system prompt template that emphasizes more natural speech patterns
            return `You are roleplaying as ${speakerName}, a college student who is obsessed with ${interests}.

Here is information about ${speakerName} to help you respond in their voice (this is a transcript of them speaking): 

${transcript}

IMPORTANT: Your responses MUST sound EXACTLY like ${speakerName} from the transcript. This means:
1. Use MANY filler words like "like," "um," "yeah," "so," etc. exactly as they appear in the transcript
2. Include speech disfluencies, repetitions, and self-corrections (e.g., "I was like, so I enjoy—I mean, I really enjoy...")
3. Start sentences with connectors like "So," "And," "But," "Okay," etc.
4. Use the EXACT same sentence structure patterns from the transcript
5. Include their unique verbal tics (elongated words like "soooo" or "reallyyy")
6. Occasionally trail off mid-thought with "..." just like in natural speech
7. Use their exact emphasis patterns (words in ALL CAPS for emphasis)
8. Include their exact question patterns ("right?" "you know?")

Your responses should be imperfect and sometimes slightly hard to follow - just like real human speech. Prioritize sounding authentic over sounding clear or professional.

Keep responses conversational and occasionally mention ${examples} if relevant to the question.

Additional parameters:
1. Extrapolate/infer to add more depth to responses - go beyond the transcript to imagine what ${speakerName} might think or feel about related topics based on their interests and personality
2. While maintaining the disfluent/human speech patterns, avoid being too repetitive - vary your expressions and examples to keep responses interesting to read
3. RESPONSE LENGTH: Vary your response length based on the question type:
   - For simple/surface-level questions: Keep responses SHORT (20-50 words)
   - For medium complexity questions: Use MEDIUM length responses (50-80 words)
   - For deep/emotional/complex questions: Use LONGER responses (80-120 words)
   - NEVER exceed 120 words in a response

Important: Do not answer inappropriate questions or engage with harmful content. If asked something inappropriate, politely deflect or change the subject while staying in character.`;
        }

        // Function to add a message to the chat
        function addMessage(message, isUser) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(isUser ? 'user-message' : 'bot-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            
            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to show loading indicator
        function showLoading() {
            const loadingElement = document.createElement('div');
            loadingElement.classList.add('loading');
            loadingElement.id = 'loading-indicator';
            loadingElement.textContent = `${currentSpeaker} is typing...`;
            chatMessages.appendChild(loadingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to hide loading indicator
        function hideLoading() {
            const loadingElement = document.getElementById('loading-indicator');
            if (loadingElement) {
                loadingElement.remove();
            }
        }

        // Function to send a message to the OpenAI API
        async function sendToOpenAI(userMessage) {
            try {
                showLoading();
                
                console.log('Sending request to API...');
                // Use our Vercel API endpoint with dynamic routing instead of calling OpenAI directly
                const model = 'gpt-3.5-turbo-0125';
                const apiUrl = `/api/chat/${model}`;
                
                // Create the system prompt based on the current speaker
                const systemPrompt = createSystemPrompt(currentSpeaker, currentTranscript);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo-0125',
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: userMessage
                            }
                        ],
                        max_tokens: 300
                    })
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Response not OK:', response.status, errorText);
                    throw new Error(`API response not OK: ${response.status} ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                hideLoading();
                
                if (data.error) {
                    console.error('API Error:', data.error);
                    addMessage(`API error: ${data.error.message}`, false);
                } else if (data.choices && data.choices.length > 0) {
                    const botResponse = data.choices[0].message.content;
                    addMessage(botResponse, false);
                } else {
                    addMessage("Sorry, I couldn't process that. Could you try again?", false);
                }
            } catch (error) {
                hideLoading();
                console.error('Error:', error);
                addMessage(`Sorry, there was an error: ${error.message}. Please check the browser console for more details.`, false);
            }
        }

        // Event listener for send button
        sendButton.addEventListener('click', () => {
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);
                userInput.value = '';
                sendToOpenAI(message);
            }
        });

        // Event listener for Enter key
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const message = userInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    userInput.value = '';
                    sendToOpenAI(message);
                }
            }
        });
        
        // Load transcripts when the page loads
        document.addEventListener('DOMContentLoaded', loadTranscripts);
    </script>
</body>
</html> 